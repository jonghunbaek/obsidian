[[파괴되지 않은 건물]]

## 1단계: 1차원에서 이해하기

### 문제 상황
배열 `[0, 0, 0, 0, 0]`가 있고, 다음 연산을 수행한다고 가정:
- 인덱스 1~3에 +5
- 인덱스 2~4에 +3
### 일반적인 방식 (느림)
```java
// 연산 1: 인덱스 1~3에 +5
arr[1] += 5;  // [0, 5, 0, 0, 0]
arr[2] += 5;  // [0, 5, 5, 0, 0]
arr[3] += 5;  // [0, 5, 5, 5, 0]

// 연산 2: 인덱스 2~4에 +3
arr[2] += 3;  // [0, 5, 8, 5, 0]
arr[3] += 3;  // [0, 5, 8, 8, 0]
arr[4] += 3;  // [0, 5, 8, 8, 3]
```
각 구간마다 모든 원소를 돌아야 함 → **O(구간 길이)**

### 차분 배열 방식 (빠름)
**핵심 아이디어**: "시작점에 +값, 끝+1 지점에 -값"만 표시
```java
// 차분 배열 초기화
diff = [0, 0, 0, 0, 0, 0]  // 크기를 1 더 크게

// 연산 1: 인덱스 1~3에 +5
diff[1] += 5;   // 시작점
diff[4] -= 5;   // 끝+1
// diff = [0, 5, 0, 0, -5, 0]

// 연산 2: 인덱스 2~4에 +3
diff[2] += 3;   // 시작점
diff[5] -= 3;   // 끝+1
// diff = [0, 5, 3, 0, -5, -3]
```

```java
result[0] = 0
result[1] = 0 + 5 = 5
result[2] = 5 + 3 = 8
result[3] = 8 + 0 = 8
result[4] = 8 + (-5) = 3
result[5] = 3 + (-3) = 0

// 결과: [0, 5, 8, 8, 3]  ✅ 정답!
```
## 2단계: 왜 이게 작동할까?
차분 배열의 의미를 생각해보면:
```
diff[i] = "i번째 위치에서 변화량"
누적합 = 0번부터 i번까지의 모든 변화량의 합
       = 실제로 i번 위치에 적용된 총 변화량
```

**예시로 이해:**
```
구간 [1~3]에 +5를 하고 싶다
→ 1번에서 +5 시작
→ 4번부터는 더이상 +5가 적용되면 안됨
→ 그래서 4번에 -5를 표시

누적합하면:
- 0번: 0
- 1번: 0 + 5 = 5  (✓ +5 적용 시작)
- 2번: 5 + 0 = 5  (✓ +5 유지)
- 3번: 5 + 0 = 5  (✓ +5 유지)
- 4번: 5 + (-5) = 0  (✓ +5 종료)
```

## 3단계: 2차원으로 확장
이제 2차원 격자에서 직사각형 영역 `[r1,c1] ~ [r2,c2]`에 값을 더해야 한다면?
### 시각적 이해
```
원본 보드 (3x3):
0  0  0
0  0  0
0  0  0

구간 [0,0] ~ [1,1]에 +5를 하고 싶다
→ 색칠된 부분에만 +5:
■  ■  0
■  ■  0
0  0  0
````
### 차분 배열 표시
**4개 모서리에 표시:**
```java
diff[r1][c1] += 5        // 좌상단: 시작
diff[r1][c2+1] -= 5      // 우상단: 가로 끝
diff[r2+1][c1] -= 5      // 좌하단: 세로 끝
diff[r2+1][c2+1] += 5    // 우하단: 대각선 보정

diff 배열 (4x4로 확장):
+5  0  -5  0
 0  0   0  0
-5  0  +5  0
 0  0   0  0


### 누적합 계산

**1) 가로 방향 누적합:**
+5  +5  0  0
 0   0  0  0
-5  -5  0  0
 0   0  0  0

**2) 세로 방향 누적합:**
+5  +5  0  0
+5  +5  0  0
 0   0  0  0
 0   0  0  0
```
**결과**: [0,0]~[1,1] 영역에만 정확히 +5가 적용됨! ✅
## 4단계: 왜 4개 모서리인가?
포함-배제 원리(Inclusion-Exclusion)를 사용합니다:
```
diff[r1][c1] += 5:
    전체에 영향 (누적합이므로 오른쪽, 아래로 전파)
    
diff[r1][c2+1] -= 5:
    오른쪽으로 넘어가는 부분 취소
    
diff[r2+1][c1] -= 5:
    아래로 넘어가는 부분 취소
    
diff[r2+1][c2+1] += 5:
    우하단은 2번 취소되었으므로 다시 복원
````