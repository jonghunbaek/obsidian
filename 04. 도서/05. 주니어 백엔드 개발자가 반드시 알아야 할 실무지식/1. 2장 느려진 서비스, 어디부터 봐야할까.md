서비스가 느려졌다면 해결을 위한 실마리를 어디서부터 찾아야 할까?
서버 성능과 관련된 중요한 두 가지 지표가 있다.
- **응답 시간**
- **처리량**
이 두 가지를 토대로 병목이 일어나는 곳의 단서를 얻을 수 있다. 
# 1. 처리량과 응답 시간
응답 시간은 `TTFB(Time to First Byte)`와 `TTLB(Time to Last Byte)` 두 가지로 나누어 측정할 수 있는데, 상황에 맞는 지표를 선택하는 것이 중요
-> 첫 패킷 도착 시간까지 측정 or 마지막 패킷 도착 시간까지 측정

클라이언트에서 `서버와 연결하는 과정(TCP 3way-handshake)` 과 `데이터를 전송하는 과정` 크게 두 가지로 구분할 수 있다.
이중, 데이터 전송 과정인 DB / 외부 API 연동이 성능 개선의 핵심이 된다. 
-> 가장 많은 처리 시간을 소모함

응답 시간의 증가는 사용자 이탈로 이어질 수 있기 때문에 다음과 같은 방안으로 **처리량을 늘려 개선**할 수 있다. 
- `서버가 동시에 처리할 수 있는 요청수를 늘려 대기 시간 줄이기`
- `처리 시간 자체를 줄여 대기 시간을 줄이기`

개선을 위해선 먼저 현재 상태를 알아야 한다. 트래픽이 많은 시간대를 기준으로 아래 두 지표를 측정한다. 
- `TPS`
	- 모니터링 시스템으로 확인
- `응답 시간`


# 2. 서버 성능 개선 기초
트래픽이 증가하면서 성능 문제가 발생하는 주된 이유는 시스템이 수용할 수 있는 최대 TPS를 초과하는 트래픽이 발생하기 때문이다.
따라서, **처리 시간이 오래 걸리는 작업을 식별해 개선하거나 다른 방법을 사용**해야 한다.

### 수직 확장, 수평 확장
성능을 개선하는 가장 간편한 방법 중 하나는 수직 확장이다. 
하지만 한계가 명확한 방법이고, 비용 문제 또한 크다. 

이러한 **단점을 상쇄하는 것이 수평 확장이지만 고려할 사항**이 훨씬 많다.  
- `DB 확장 시 데이터 불일치 문제`
- `서버 확장 시 DB에 가해지는 부하`
	- DB에 문제 있는 상황이라면 더 많아진 커넥션으로 오히려 성능이 저하됨
- `비용 문제`
### 서버 캐시
수직, 수평 확장은 성능을 빠르게 개선할 수 있지만 비용문제가 항상 뒤따른다.
또한 **DB의 경우 한 번 수평 확장을 해 놓으면 다시 줄이기가 어려우며, 처리량만 늘어날 뿐 실행 시간이 획기적으로 줄지 않는다.** 

이러한 문제들에 대한 대체 방안으로 캐시를 활용할 수 있다. 
캐시를 사용해야 한다면 다음과 같은 요소를 고려해야 한다.
- `캐시 key 설정`
- `적중률과 삭제 규칙`
- `로컬 vs 리모트`
	- 데이터 규모가 작고 변경 빈도가 매우 낮다면 로컬 캐시, 반대면 리모트 캐시
- `캐시 사전 적재`
	- 캐시 스탬피드 현상 방지
- `캐시 무효화`
	- 유효하지 않은 데이터 제거
### GC와 메모리 사용
